---
title: "Amy Y"
format: html
---

```{r}
library(ggplot2)
library(tidyverse)
library(sf)
library(rnaturalearth)

estimated_numbers <- read.csv("../../data/archive 2/estimated_numbers.csv") 
incidence <-read.csv("../../data/archive 2/incidence_per_1000_pop_at_risk.csv")
reported <-read.csv("../../data/archive 2/reported_numbers.csv") #use this one

world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf")
```

```{r}
dim(reported)

reported_clean <- reported %>%
  rename(deaths = No..of.deaths)   

map_data <- world %>%
  left_join(reported_clean, by = c("name" = "Country"))
```

```{r}
ggplot(map_data) +
  geom_sf(aes(fill = deaths), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", trans = "log10") +
  facet_wrap(~ Year) +
  theme_minimal() +
  labs(
    title = "Reported Deaths by Country Over Time",
    fill = "Deaths (log scale)"
  )
```
```{r}
library(plotly)
library(dplyr)
library(countrycode)
```

```{r}
# Example: cleaning reported data
# Replace 'country', 'year', and 'deaths' with your real column names
reported_clean_2 <- reported %>%
  mutate(
    country = countrycode(Country, origin = "country.name", destination = "iso3c"),
  #  year = as.integer(Year),
 #   deaths = as.numeric(No..of.deaths)
  ) %>%
  filter(!is.na(country), 
        # !is.na(year), 
       #  !is.na(deaths)
         )
```

```{r}
fig <- plot_ly(
  data = reported_clean_2,
  type = "choropleth",
  locations = ~country,
  z = ~No..of.deaths,
  frame = ~Year,
  colorscale = "Reds",
  text = ~paste(Country, "<br>Deaths:", No..of.deaths),
  colorbar = list(title = "Deaths"),
  reversescale = FALSE
)

fig <- fig %>%
  layout(
    title = "Reported Deaths by Country Over Time",
    geo = list(showframe = FALSE,
               showcoastlines = FALSE,
               showcountries = TRUE,
               countrycolor = "gray",
               projection = list(type = "equirectangular"),
               bgcolor = "white",
               landcolor = "white")
  )

fig
```

::: {.callout-note title="Caption"}
This interactice choropleth map shows the number of reported deaths of malaria by countries from 2000 to 2017. Countries shaded in deeper red tones indicate higher death counts, while countries in paler or base colors report fewer or no deaths in a given year. All the coutries appearing with the base color are included in the dataset. 
:::
